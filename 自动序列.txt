create table `sys_sequence` (
  `name` varchar(50) collate utf8_bin not null comment '名称',
  `current_value` int(11) not null default '0' comment '当前值',
  `increment` int(11) not null default '1' comment '增长长度',
  `pklen` int(11) default null comment '长度',
  `nickname` varchar(50) collate utf8_bin default 'sn' comment '别名',
  `systemname` varchar(21) collate utf8_bin default null comment '系统名称',
  `systemtime` varchar(21) collate utf8_bin default null comment '时间',
  `systemid` varchar(21) collate utf8_bin default null comment '系统id',
  primary key (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=DYNAMIC COMMENT='序列表';


DELIMITER $$

DROP FUNCTION IF EXISTS `nextId`$$

CREATE FUNCTION `nextId`(PK_ID VARCHAR(21)) RETURNS VARCHAR(21) CHARSET utf8
BEGIN
DECLARE NEXT_VAL VARCHAR(21);


		DECLARE V_LEN INTEGER;
		DECLARE V_CV INTEGER;
		DECLARE V_VALUE VARCHAR(11);
		
		SELECT CURRENT_VALUE INTO V_VALUE FROM SYS_SEQUENCE WHERE NAME = PK_ID LOCK IN SHARE MODE;
		
		UPDATE SYS_SEQUENCE SET CURRENT_VALUE = CURRENT_VALUE + INCREMENT WHERE NAME = PK_ID;		 	
			
		
		SELECT PKLEN INTO V_LEN FROM SYS_SEQUENCE WHERE NAME = PK_ID;	 
		SELECT CONCAT('',V_VALUE) INTO V_CV ;
		
		SET NEXT_VAL = CONCAT(PK_ID,LPAD(V_CV,(V_LEN - LENGTH(PK_ID)),'0'));
		 
		RETURN NEXT_VAL;
END$$

DELIMITER ;


